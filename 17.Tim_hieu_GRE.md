## GRE là gì ?

**Generic routing encapsulation (GRE)** là một giao thức sử dụng để thiết lập các kết nối **point-to-point** một các trực tiếp giữa các node trong mạng. Đây là một phương pháp đơn giản và hiệu quả để chuyển dữ liệu thông qua mạng public network, như Internet. GRE cho phép hai bên chia sẻ dữ liệu mà họ không thể chia sẻ với nhau thông qua mạng public network.

GRE đóng gói dữ liệu và chuyển trực tiếp tới thiết bị mà de-encapsulate gói tin và định tuyến chúng tới đích cuối cùng

### GRE tunneling

Dữ liệu được định tuyến bởi hệ thống GRE endpoint trên các tuyến đường được thiết lập trong bảng tuyến. (Các tuyến này có thể được cấu hình tĩnh hoặc học động bằng các giao thức định tuyến như RIP hoặc OSPF) Khi một gói dữ liệu nhận được bởi GRE endpoint, nó được decapsulation và định tuyến lại đến địa chỉ đích cuối cùng của nó.

GRE tunnel là stateless - nghĩa là tunnel endpoint không chứa thông tin về trạng thái hoặc tính sẵn có của remote tunnel endpoint. Do đó, switch hoạt động như một tunnel source router không thể thay đổi trạng thái của GRE tunnel interface thành down nếu remote endpoint không thể truy cập được.

### Encapsulation và De-Encapsulation trên switch

- **Encapsulation** : Switch hoạt động như một tunnel source router đóng gói và chuyển tiếp các gói tin GRE như sau

  - Switch nhận dữ liệu gói tin (payload) cần chuyển qua tunnel, nó sẽ chuyển gói tin ra tunnel interface
  - Tunnel interface đóng gói
  - Encapsulate dữ liệu vào trong gói tin GRE và thêm vào đó phần outer IP header để thành gói tin IP mới
  - Gói tin IP được chuyển đến địa chỉ IP đích trong phần outer IP header (là địa chỉ IP của tunnel interface nhận)
- **De-encapsulation** : switch hoạt động như một tunnel remote router xử lý gói tin GRE như sau :
  - Khi đích outer IP nhận được gói tin từ tunnel interface, outer IP header và GRE header sẽ được bóc tách khỏi gói tin
  - Gói tin được định tuyến tới địa chỉ đích cuối cùng dựa vào inner IP header
  
