## Storage 

Chúng ta cần storage để tạo và lưu trữ các virtual disk. Storage được tạo và quản lý sử dụng libvirt storage API và được gọi là **storage pool**

## Làm việc với unmanaged storage

Storage không trực tiếp được quản lí và giám sát bởi libvirt mà nó vẫn được sử dụng cho virtual machine thì được gọi là ``unmanaged storage``. Có nghĩa là ta có thể sử dụng bất cứ file nào hoặc block device có trên host như một virtual disk. Điều này cung cấp cách nhanh nhất để cung cấp storage cho virtual machine

### Tạo disk image 

Disk image là một tiêu chuẩn file được lưu trữ trên host. Ta có thể tạo file image sử dụng câu lệnh dd :

`` dd if=/dev/zero of=/var/lib/libvirt/qemu/dbvm_disk2_prellocated.img bs=1G count=5``

Khi câu lệnh chạy xong thì ta sẽ có image 5GB preallocated và sẵn sàng được sử dụng như là boot disk hay second disk. Ta cũng có thể tạo thin-provisioned disk image. Preallocated và thin-provisioned là các format phân bổ disk. Tùy vào từng trường hợp mà ta chọn preallcated hay thin-provisioned

- **Preallcated** : Preallcated được gán định không gian disk ngay khi được tạo và có tốc độ ghi nhanh hơn so với thin provisioning
- **Thin-Provisioned** : Với phương pháp này, dung lượng sẽ được phân bố khi cần. Ví dụ khi tạo một disk image 10G với thin-provisioned. Nó sẽ chỉ lấy dung lượng mà nó dùng và sẽ lớn lên dần khi lên đến 10G. Để tạo thin-provision disk, sử dụng option ``seek`` với câu lệnh ``dd``: 

``dd if=/dev/zero of=/var/lib/libvirt/qemu/dbvm_disk2.img bs=1G seek=5 count=0``

Xem thông tin image với câu lệnh ``qemu-img``: 

```
[root@vuvinh qemu]# qemu-img info /var/lib/libvirt/qemu/dbvm_disk2_prellocated.img
image: /var/lib/libvirt/qemu/dbvm_disk2_prellocated.img
file format: raw
virtual size: 5.0G (5368709120 bytes)
disk size: 5.0G
[root@vuvinh qemu]# qemu-img info /var/lib/libvirt/qemu/dbvm_disk2.img
image: /var/lib/libvirt/qemu/dbvm_disk2.img
file format: raw
virtual size: 5.0G (5368709120 bytes)
disk size: 0
```

